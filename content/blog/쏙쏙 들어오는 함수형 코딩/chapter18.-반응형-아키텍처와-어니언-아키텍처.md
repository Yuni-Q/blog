---
title: CHAPTER18. 반응형 아키텍처와 어니언 아키텍처
date: 2023-04-22 20:04:78
category: 쏙쏙 들어오는 함수형 코딩
tags: ['PART II 일급 추상']
draft: true
---

## 이번 장에서 살펴볼 내용

- 반응형 아키텍처로 순차적 액션을 파이프라인으로 만드는 방법을 배웁니다.
- 상태 변경을 다루기 위한 기본형을 만듭니다.
- 도메인과 현실 세계의 상호작용을 위한 어니언 아키텍처를 만듭니다.
- 여러 계층에 어니언 아키텍처를 적용하는 방법을 살펴봅니다.
- 전통적인 계층형 아키텍처와 어니언 아키텍처를 비교해 봅니다.

## 두 아키텍처 패턴은 독립적입니다.

- 반응형 아키텍처는 순차적 액션 단계에 사용하고, 어니언 아키텍처는 모든 단계에 사용합니다.

### 반응형 아키텍처

- 반응형 아키텍처는 코드에 나타난 순차적 액션의 순서를 뒤집습니다.
- `효과`와 `그 효과에 대한 원인`을 `분리`해서 코드에 복잡하게 꼬인 부분을 풀 수 있습니다.
- 반응형 아키텍처는 애플리케이션을 구조화하는 방법입니다.
- 반응형 아키텍처의 핵심 원칙은 이벤트에 대한 반응으로 일어날 일을 지정하

#### 반응형 아키텍처가 시스템을 어떻게 바꿨나요?

1. 원인과 효과가 결합된 것을 분리합니다.
2. 여러 단계를 파이프라인으로 처리합니다.
3. 타임라인이 유연해집니다.

### 어니언 아키텍처

- 어니언 아키텍처는 웹 서비스나 온도 조절 장치 같은 현실 세계와 상호작용하기 위한 서비스 구조를 만듭니다.
- 함수형 사고를 적용한다면 자연스럽게 쓸 수 있는 아키텍처입니다.
- 반응형 아키텍처오하 함께 사용하면 반응형 아키텍처가 어니언 아키텍처 안에 들어 있는 것을 볼 수 있지만 서로 의존하지는 않습니다.

#### 어니언 아키텍처의 계층

- 인터렉션 계층: 바깥세상에 영향을 주거나 받는 액션
- 도메인 계층: 비즈니스 규칙을 정의하는 계산
- 언어 계층: 언어 유틸리티와 라이브러리

#### 어니언 아키텍처의 분류

1. 현실 세계와 상호작용은 인터렉션 계층에서 해야 합니다.
2. 계층에서 호출하는 방향은 중심 방향입니다.

### 전통적인 계층형 아키텍처

- 전통적인 게층형 아키텍처는 데이터베이스를 기반으로 합니다. 데이터베이스 계층이 가장 아래 있다면 그 위에 있는 모든 것은 액션이 되기 때문에 함수형 스타일이 아닙니다.
  - 웹 인터페이스 계층: 웹 요청을 도메인으로 바꾸고 도메인을 웹 응답으로 바꿉니다.
  - 도메인 계층: 애플리케이션 핵심 로직으로 도메인 개념에 DB 쿼리나 명령이 들어갑니다.
  - 데이터베이스 계층: 시간에 따라 바뀌는 정보를 저장합니다.

### 함수형 아키텍처

- 함수형 아키텍처는 도메인 계층이 데이터베이스 계층에 의존하지 않습니다.
  - 데이터베이스는 변경 가능하고 접근하는 모든 것을 액션으로 만든다는 것이 핵심입니다.

## 변경과 재사용이 쉬워야 합니다

- 어니언 아키텍처는 인터렉션 계층을 바꾸기 쉽습니다. 그래서 도메인 계층을 재사용하기 좋습니다.
- 어니언 아키텍처는 데이터베이스나 API 호출과 같은 외부 서비스를 바꾸기 쉽습니다. 가장 높은 계층에서 사용하기 때문입니다.
- 도메인 계층은 외부 서비스에 의존하지 않아서 테스트하기 좋습니다.
- 어니언 아키텍처는 좋은 인프라보다 좋은 도메인을 강조합니다.

## 도메인 규칙은 도메인 용어를 사용합니다

- 도메인 규칙은 도메인 용어를 사용합니다. 도메인 규칙에 속하는지 인터렉션 계층에 속하는지 판단하려면 코드에서 사용하는 용어를 보면 됩니다.

## 요점 정리

- 반응형 아키텍처는 코드에 나타난 순차적 액션의 순서를 뒤집습니다. X를 하고 Y를 하는 것을 X가 발생하면 Y를 하도록 바꿉니다.
- 반응형 아키텍처는 액션과 계산을 조합해 파이프라인을 만듭니다. 파이프라인은 순서대로 발생하는 작은 액션들의 조합입니다.
- 읽고 쓰는 동작을 제한해 변경 가능한 일급 상태를 만들 수 있습니다. ValueCell은 스프레드시트에서 영향을 받아 만들었습니다. ValueCell로 반응형 파이프라인을 구현할 수 있습니다.
- 어니언 아키텍처는 넓은 범위에서 소프트웨어를 세 개의 계층으로 나눕니다. 인터렉션과 도메인, 언어 계층입니다.
- 가장 바깥 인터렉션 계층은 액션으로 되어 있습니다. 도메인 계층과 액션을 사용하는 것을 조율합니다.
- 도메인 계층은 소프트웨어를 만들 수 있는 언어 기능과 라이브러리로 되어 있습니다.
  [label](chapter17.-%ED%83%80%EC%9E%84%EB%9D%BC%EC%9D%B8-%EC%A1%B0%EC%9C%A8%ED%95%98%EA%B8%B0.md)- 어니언 아키텍처는 프랙털입니다. 액션의 모든 추상화 수준에서 찾을 수 있습니다.
  - 프랙털(fractal)은 일부 조각이 전체와 비슷한 구조입니다. 어니언 아키텍처를 소프트웨어 전체에 적용할 수도 있지만, 작은 부분에서도 같은 모습으로 적용할 수 있기 때문에 프랙털에 비유했습니다.

---

## 참고

- [쏙쏙 들어오는 함수형 코딩](https://product.kyobobook.co.kr/detail/S000001952246)
