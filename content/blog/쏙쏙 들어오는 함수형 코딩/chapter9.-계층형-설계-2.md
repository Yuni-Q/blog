---
title: CHAPTER9. 계층형 설계 2
date: 2023-03-12 19:03:41
category: 쏙쏙 들어오는 함수형 코딩
tags: ['PART I 액션과 계산, 데이터']
draft: true
---

## 이번 장에서 살펴볼 내용

- 코드를 모듈화하기 위해 추상화 벽을 만드는 법을 배웁니다.
- 좋은 인터페이스가 어떤 것이고, 어떻게 찾는지 알아봅시다.
- 설계에 이만하면 되었다고 할 수 있는 시점을 압니다.
- 왜 계층형 설계가 유지보수와 테스트, 재사용에 도움이 되는지 이해합니다.

## 계층형 설계 패턴

- 패턴 1: 직접 구현
- 패턴 2: 추상화 벽
- 패턴 3: 작은 인터페이스
- 패턴 4: 편리한 계층

## 패턴 2: 추상화 벽

- 추상화 벽(abstraction barrier)은 세부 구현을 감춘 함수로 이루어진 계층입니다. 추상화 벽에 있는 사용할 때는 구현을 전혀 몰라도 함수를 쓸 수 있습니다.
- 세부적인 것을 감추는 것은 대칭적입니다.
- 추상화 벽은 '어떤 것을 신경 쓰지 않아도 되지?'라는 말을 거창하게 표현한 개념입니다.

## 추상화 벽은 언제 사용하면 좋을까요?

### 1. 쉽게 구현을 바꾸기 위해

- 구현에 대한 확신이 없는 경우 추상화의 벽을 사용하면 구현을 간접적으로 사용할 수 있기 때문에 나중에 구현을 바꾸기 쉽습니다. 하지만 오지 않을 수도 있는 미래를 위한 불필요한 코드를 작성하는 것은 좋지 않습니다.

### 2. 코드를 읽고 쓰기 쉽게 만들기 위해

- 추상화의 벽을 사용하면 세부적인 것을 신경 쓰지 않아도 됩니다.

### 3. 팀 간에 조율해야 할 것을 줄이기 위해

- 추상화 벽을 사용하면 각 팀에 관한 구체적인 내용을 서로 신경 쓰지 않아도 일할 수 있습니다. 게다가 더 빠르게 일할 수 있습니다.

### 4. 주어진 문제에 집중하기 위해

- 추상화의 벽을 사용하면 해결하려는 문제의 구체적인 부분을 무시할 수 있습니다. 그렇기 때문에 코드에 실수를 줄이고, 만들면서 지치지 않을 수 있습니다.

## 패턴 2 리뷰: 추상화의 벽

- 추상화 벽으로 추상화 벽 아래에 있는 코드와 위에 있는 코드의 의존성을 없앨 수 있습니다.
  - 일반저긍로 추상화 벽 위에 있는 코드는 데이터 구조와 같은 구체적인 내용을 신경 쓰지 않아도 됩니다.
- 추상화 단계의 상위에 있는 코드와 하위에 있는 코드는 서로 의존하지 않게 정의합니다. 추상화 단계의 모든 함수는 비슷한 세부 사항을 무시할 수 있도록 정의합니다.
- 바뀌지 않을지도 모르는 코드를 언젠가 쉽게 바꿀 수 있게 만들려는 함정에 빠지지 않아야 합니다.
- 추상화의 벽은 팀 간에 커뮤니케이션 비용을 줄이고, 복잡한 코드를 명확하게 하기 위해 전략적으로 사용해야 합니다.
- 신경 쓰지 않아도 되는 것을 다루는 것이 추상화 벽의 핵심입니다.

## 패턴 3: 작은 인터페이스

- 작은 인터페이스 패턴은 새로운 코드를 추가할 위치에 관한 것입니다.
- 인터페이스를 최소화 하면 하위 계층에 불필요한 기능이 쓸데없이 커지는 것을 막을 수 있습니다.
- 새로운 기능을 만들 때 하위 계층에 기능을 추가하거나 고치는 것보다 상위 계층에 만드는 것이 작은 인터페이스 패턴이라고 할 수 있습니다.
- 작은 인터페이스 패턴은 추상화 벽뿐만 아니라 모든 계층에 적용할 수 있는 패턴입니다.
- 작은 인터페이스 패턴을 사용하면 깨끗하고 단순하고 믿을 수 있는 인터페이스에 집중할 수 있습니다. 그리고 감춰진 코드의 나머지 부분을 대신하는 코드로 사용할 수 있습니다. 또 인터페이스가 많아져서 생긴느 불필요한 변경이나 확장을 막아 줍니다.

## 패턴 3 리뷰: 작은 인터페이스

- 추상화 벽을 작게 만들어야 하는 이유
  1. 추상화 벽에 코드가 많을수록 구현이 변경되었을 때 고쳐야 할 것이 많습니다.
  2. 추상화 벽에 있는 코드는 낮은 수준의 코드이기 때문에 더 많은 버그가 있을 수 있습니다.
  3. 낮은 수준의 코드는 이해하기 더 어렵습니다.
  4. 추상화 벽에 코드가 많을수록 팀 간 조율해야 하는 것도 많아집니다.
  5. 추상화 벽에 인터페이스가 많으면 알아야 할 것이 많아 사용하기 어렵습니다.
- 상위 계층에 어떤 함수를 만들 때 가능한 현재 계층에 있는 함수로 구현하는 것이 작은 인터페이스를 실천하는 방법입니다.
- 계층이 가진 함수는 완전하고, 적고, 시간이 지나도 바뀌지 않아야 합니다. 이것이 작은 인터페이스가 전체 계층에 사용되는 이상적인 모습입니다.

## 패턴 4: 편리한 계층

- 만약 작업하는 코드가 편리하다고 느낀다면 설계는 조금 멈춰도 됩니다.

## 그래프로 알 수 있는 코드에 대한 정보는 무엇이 있을까요?

- 호출 그래프는 함수가 어떤 함수를 호출하는지 있는 그대로 보여줍니다. 호출 그래프에서 함수 이름을 없애면 구조에 대한 추상적인 모습을 불 수 있습니다.
  - 호출 그래프에 함수 이름을 뺴고 보면, 코드 위치를 통해 세 가지 중요한 비기능적 요구사항에 답할 수 있습니다.
- 호출 그래프의 구조는 세 가지 중요한 비 기능적인 요구사항을 꾸밈없이 보여줍니다.
  - 기능적 요구사항(functional requirements)은 소프트웨어가 정확히 해야 하는 일을 말합니다.
  - 비기능적 요구사항(nonfunctional requirements, NFRs)은 테스트를 어떻게 할 것이지, 재사용을 잘할 수 있는지, 유지보수하기 어렵지 않은지와 같은 요구사항들입니다. 비기능적 요구사항은 소프트웨어 설계를 하는 중요한 이유입니다.
- 위에 있는 코드가 바꾸기 쉽고, 아래에 있는 코드가 테스트하는 것이 더 중요합니다.
- 낮은 계층은 재사용하기 더 좋습니다. 아래쪽으로 가리키는 화살표가 많은 함수는 재사용하기 어렵습니다.

### 호출 그래프로 알 수 있는 세 가지 비기능적 요구사항

- 유지보수성(maintainability): 요구 사항이 바뀌었을 때 가장 쉽게 고칠 수 있는 코드는 어떤 코드인가요?
- 테스트성(testability): 어떤 것을 테스트하는 것이 가장 중요한가요?
- 재사용성(reusability): 어떤 함수가 재사용하기 좋나요?

## 요약: 그래프가 코드에 대해 알려주는 것

### 유지보수성

- 규칙: 위로 연결된 것이 적은 함수가 바꾸기 쉽습니다.
- 핵심: 자주 바뀌는 코드는 가능한 위쪽에 있어야 합니다.

### 테스트 가능성

- 규칙: 위쪽으로 많이 연결된 함수를 테스트하는 것이 더 가치 있습니다.
- 핵심: 아래쪽에 있는 함수를 테스트하는 것이 위쪽에 있는 함수를 테스트하는 것보다 가치 있습니다.

### 재사용성

- 규칙: 아래쪽에 함수가 적을수록 더 재사용하기 좋습니다.
- 핵심: 낮은 수준의 단계로 함수를 빼내면 재사용성이 더 높아집니다.

## 요점 정리

- 추상화 벽 패턴을 사용하면 세부적인 것을 완벽히 감출 수 있기 때문에 더 높은 차원에서 생각할 수 있습니다.
- 작은 인터페이스 패턴을 사용하면 완성된 인터페이스에 가깝게 계층을 만들 수 있습니다. 중요한 비즈니스 개념을 표현한느 인터페이스는 한번 잘 만들어 놓고 더 바뀌거나 늘어나지 않아야 합니다.
- 편리한 계층 패턴을 이용하면 다른 패턴을 요구 사항에 맞게 사용할 수 있습니다. 패턴을 사용하다 보면 너무 과한 추상화를 할 수 있습니다. 패턴들은 요구 사항에 맞게 적용해야 합니다.
- 호출 그래프 구조에서 규칙을 얻을 수 있습니다. 이 규칙으로 어떤 코드를 테스트하는 것이 가장 좋은지, 유지보수나 재사용하기 좋은 코드는 어디에 있는 코드인지 알 수 있습니다.

---

## 참고

- [쏙쏙 들어오는 함수형 코딩](https://product.kyobobook.co.kr/detail/S000001952246)
