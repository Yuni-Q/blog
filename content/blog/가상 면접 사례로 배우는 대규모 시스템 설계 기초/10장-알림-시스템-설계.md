---
title: 10장 알림 시스템 설계
date: 2022-09-12 00:09:21
category: 가상 면접 사례로 배우는 대규모 시스템 설계 기초
tags: []
draft: true
---

- 고객에게 중요할 만한 정보를 비동기적으로 제공합니다.
- 알림 시스템은 모바일 푸시 알람, SMS 메시지, 그리고 이메일의 세 가지로 분류할 수 있습니다.
- iOS는 APSN 서비스를, 안드로이드는 FCM(Firebase Cloud Messaging)를 사용합니다.
- 알림이 지연되거나 순서가 틀려도 괜찮지만,사라지면 곤란합니다. 이를 위해 데이터베이스에 보관하고 재시도 메커니즘 구현이 필요합니다.
- 같은 알람이 여러 번 반복되는 것을 완전히 막는 것은 가능하지 않습니다.

## 설계

### 설계 1

- 1부터 N까지의 서비스: 알림 시스템 서버의 API를 통해 알림을 보낼 서비스들.
- 알림 시스템(notification system): 서비스 1-N에 알람 전송을 위한 API를 제공해야 하고, 제3자 서비스에 전달할 알람 페이로드(payload)를 만들어 낼 수 있어야 합니다.
- 제3자 서비스(third party services): 이 서비스들은 알림을 실제로 전달하는 역할을 합니다.
- iOS, 안드로이드, SMS, 이메일 단말

### 문제

- SPOF(Single-Point-Of-Failure)
- 규모의 확장성

### 개선안 1

- 데이터베이스와 캐시를 알림 시스템의 주 서버에서 분리합니다.
- 알림 서버를 증설하고 자동으로 수평적 구묘 확장이 이루어질 수 있도록 합니다.
- 메시지 큐를 이용해 시스템 컴포넌트 사이의 강한 결합을 끊습니다.

### 설계 2

- 1부터 N까지의 서비스: 알림 시스템 서버의 API를 통해 알림을 보낼 서비스들.
- 알림 서버(notification services)
  - 알림 전송 API
  - 알림 검증(validation)
  - 데이터베이스 또는 캐시 질의
  - 알림 전송
- 캐시(cache)
- 데이터베이스(DB)
- 메시지 큐(message queue): 시스템 컴포넌트 간 의존성을 제거하기 위해 사용합니다. 다량의 알림이 전송되어야 하는 겨우를 대비한 버퍼 역할도 합니다.
- 작업 서버(workers): 메시지 큐에서 전송할 알람을 꺼내서 제3자 서비스로 전달하는 역할을 담당하는 서버입니다.
- 제3자 서비스(third party services): 이 서비스들은 알림을 실제로 전달하는 역할을 합니다.
- iOS, 안드로이드, SMS, 이메일 단말

### 개선안 2

- 알림 서버에 인증(authentication)과 전송률 제한(rate-limiting) 기능이 추가되었습니다.
- 전송 실패에 대응하기 위한 재시도 기능이 추가되었습니다. 전송에 실패한 알림은 다시 큐에 넣고 지정된 횟수만큼 재시도합니다.
- 전송 템플릿을 사용하여 알림 생성 과정을 단순화하고 알림 내용의 일관성을 유지합니다.
- 모니터링과 추적 시스템을 추가하여 시스템 상태를 확인하고 추후 시스템을 개선하기 쉽도록 합니다.

## 마무리

- 안정성(reliability): 메시지 전송 실패율을 낮추기 위해 안정적인 재시도 메커니즘을 도입합니다.
- 보안(security): 인증된 클라이언트만이 알림을 보낼 수 있도록 AppKey, appSecret 등의 메커니즘을 이용합니다.
- 이벤트 추적 및 모니터링: 각 단계마다 이벤트를 추적하고 모니터링 할수 있는 시스템을 통합합니다.
- 사용자 설정: 사용자가 알림 수신 설정을 조정할 수 있도록 합니다.
- 전송률 제한: 사용자에게 알림을 보내는 빈도(frequency)를 제한할 수 있습니다.

---

## 참고

- [가상 면접 사례로 배우는 대규모 시스템 설계 기초](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788966263158)
