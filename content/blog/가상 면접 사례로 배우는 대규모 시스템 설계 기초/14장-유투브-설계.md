---
title: 14장 유투브 설계
date: 2022-09-27 21:09:92
category: 가상 면접 사례로 배우는 대규모 시스템 설계 기초
tags: []
draft: true
---

## 비디오 업로드 절차 설계안

- 사용자
- 로드 밸런서
- API 서버
- 메타데이터 데이터베이스
- 메타데이터 캐시
- 원본 저장소
- 트랜스 코딩 서버: 비디오 인코딩이라 부르기도 하는 정차로, 비디오 포맷(MPEG, HLS 등)을 변환하는 절차입니다. 단말이나 대역폭 요구사항에 맞는 최적의 비디오 스트림을 제공하기 위해 필요합니다.
- 트래스코딩 비디오 저장소: 트랜스코딩이 완료된 비디오를 저장하는 BLOB 저장소입니다.
- CDN
- 트랜스코딩 완료 큐
- 트랜스코딩 완료 핸들러

## 비디오 스트리밍 절차

- 스트리밍 프로토콜은 비디오 스트리밍을 위해 데이터를 전송할 때 쓰이는 표준화된 통신방법입니다.

## 원본 비디오

- 원본 비디오는 일단 비디오, 오디오, 메타데이터의 세 부분으로 나뉘어 처리도비니다.
- 비디오 부분에 족용되는 작업은 다음과 같습니다.
  - 검사
  - 비디오 인코딩
  - 섬네일
  - 워터마크

## 비디오 트랜스코딩 아키텍처

- 전처리기(preprocessor)
- DAG 스케줄러
- 자원 관리자(resource manager)
- 작업 실행 서버(resource worker)
- 임시 저장소(temporary storage)

### 전처리기

- 비디오 분할(video splitting): 비디오 스트림을 GOP(Group of Pictures)라고 불리는 단위로 쪼갭니다. GOP는 특정 순서로 배열된 프레임 그룹입니다. 하나의 GOP는 독립적으로 재생 가능하며, 길이는 보통 몇 초 정도입니다.
- DAG 생성: 클라이언트 프로그래머가 작성한 설정 파일에 따라 DAG를 만들어냅니다.
- 데이터 캐시: 전처리기는 분할된 비디오의 캐시이기도 합니다.

### DAG 스케줄러

- DAG 스케줄러는 DAG 그래프를 몇 개 단계로 분할한 다음에 그 각가의 자원 관리자의 작업 큐에 집어 넣습니다.

### 자원 관리자

- 자원 관리자는 자원 배분을 효과적으로 수행하는 역할을 담당합니다.

### 작업 서버

- 작업 서버는 DAG에 정의된 작업을 수행합니다.

### 임시 저장소

- 임시 저장소 구현에는 여러 저장소 시스템을 활용할 수 있습니다.

### 인코딩된 비디오

- 인코딩된 비디오는 인코딩 파이프라인의 최종 결과물입니다.

## 시스템 최적화

### 속도 최적화

- 비디오 병렬 업로드
- 업로드 센터를 사용자 근거리에 지정
- 모든 절차를 병렬화

### 안정성 최적화

- 미리 사인된 업로드 URL
- 비디오 보호
  - 디지털 저작원 관리(DRM: Digital Rights Management) 시스템 도입
  - AES 암호화
  - 워터마크

### 마무리

- API 계층의 규묘 확장성 확보 방안
- 데이터 베이스 계층의 규모 확장성 확보 방안
- 라이브 스트리밍
  - 응답지연이 좀 더 낮아야 합니다.
  - 병렬화 필요성은 떨어질 텐데, 작은 단위의 데이터를 실시간으로 빨리 처리해야 하기 때문입니다.
  - 오류 처리 방법이 달라야 합니다.
- 비디오 삭제

---

## 참고

- [가상 면접 사례로 배우는 대규모 시스템 설계 기초](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788966263158)
