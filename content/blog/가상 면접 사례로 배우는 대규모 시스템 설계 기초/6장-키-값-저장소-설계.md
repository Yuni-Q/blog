---
title: 6장 키-값 저장소 설계
date: 2022-09-04 19:09:63
category: 가상 면접 사례로 배우는 대규모 시스템 설계 기초
tags: []
draft: true
---

- 키-값 저장소는 키-값 데이터베이스라고 불리는 비 관계형 데이터베이스입니다.
- 저장되는 값은 고유 식별자로 키를 가져야 합니다.
- 키와 값 사이의 연결 관계를 '키-값' 쌍이라고 지칭합니다.
- 키-값 쌍에서의 키는 유일해야 하며 해당 키에 매달린 값은 키를 통해서만 접근할 수 있습니다.
- 키는 일반 텍스트일 수도 있고 해시 값을 수도 있습니다. 성능상의 이유로, 키는 짧을수록 좋습니다. 값은 무엇이든 상관 없습니다.
- 키-값 저장소로 널리 알려진 것으로는 아마존 다이나모, memcached, 레디스 같은 것들이 있습니다.

## 단일 서버-키 값 저장소

- 가장 직관적인 설계 방법은 카-값 쌍 전부를 메모리에 해시 테이블로 저장하는 것ㅇ비니다. 그러나 이 접근법은 빠른 속도를 보장하긴 하지만 모든 데이터를 메모리 안에 두는 것이 불가능할 수도 있다는 약점을 가지고 있습니다.
- 이를 해결하기 위해 데이터 압축(compression) 또는 자주 쓰이는 데이터만 메모리에 두고 나머지는 디스크에 저장하는 방식을 사용할 수 있습니다.

## 분산 키-값 저장소

- 분산 키-값 저장소는 분산 해시 ㅋ테이블이라고도 불ㄹ비니다. 키-값 쌍을 여러 서버에 분산시키기 때문입니다.
- 분산 시스템을 설계할 때는 CAP 정리(Consistency, Availability, Partition Tolerance theorem)를 이해하고 있어야 합니다.

## CAP

- CAP 정리는 데이터 일관성(Consistency), 가용성(Availability), 파티션 감내(Partition Tolerance theorem)라는 세 가지 요구사항을 동시에 만족하는 분산 시스템을 설계하는 것은 불가능하다라는 정리입니다.
  - 데이터 일관성 : 분산 시스템에 접속하는 모든 클라이언트는 어떤 노드에 접속했느냐에 관계없이 언제나 같은 데이터를 보게 되어야 합니다.
  - 가용성 : 분산 시스템에 접속하는 클라이언트는 일부 노드에 장애가 발생하더라도 항상 응답을 받을 수 있어야 합니다.
  - 파티션 감내 : 파티션은 두 노드 사이에 통신 장애가 발생하였음을 의미합니다. 파티션 감내는 네트워크에 파티션이 생기더라도 시스템은 계속 동작하여야 한다는 것을 뜻합니다.
- CAP 정리는 두 가지를 충족하려면 나머지 하나는 반드시 희생되어야 한다는 것을 의미합니다.
  - CP 시스템 : 일관성과 파티션 감내를 지원하는 키-값 저장소. 가용성을 희생합니다.
  - AP 시스템 : 가용성과 파티션 감내를 지원하는 키-값 저장소. 데이터 일관성을 희생합니다.
  - CA 시스템 : 일관성과 가용성을 지원하는 키-값 저장소. 파티션 감내는 지원하지 않습니다. 그러나 통상 네트워크 장애는 피할 수 없는 일로 여겨지므로, 분산 시스템은 반드시 파티션 문제를 감내할 수 있도록 설계되어야 합니다. 그러므로 실세계에 CA 시스템은 존재하지 않습니다.

## 요약

| 목표/문제                         | 기술                                                                      |
| --------------------------------- | ------------------------------------------------------------------------- |
| 대규모 데이터 저장                | 안정 해시를 사용해 서버들에 부하 분산                                     |
| 읽기 연산에 대한 높은 가용성 보장 | 데이터를 여러 데이터센터에 다중화                                         |
| 쓰기 연산에 대한 높은 가용성 보장 | 버저닝 및 벡터 시계를 사용한 충돌 해소                                    |
| 데이터 파티션                     | 안정 해시                                                                 |
| 점진적 규모 확장성                | 안정 해시                                                                 |
| 다양성(heterogeneity)             | 안정 해시                                                                 |
| 조절 가능한 데이터 일관성         | 정족수 함의(quorum consensus                                              |
| 일시적 장애 처리                  | 느슨한 정족수 프로토콜(sloppy quorum)과 단서 후 임시 위탁(hinted handoff) |
| 영구적 장애 처리                  | 머클 트리(Merkle tree)                                                    |
| 데이터 센터 장애 대응             | 여러 데이터 센터에 걸친 데이터 다중화                                     |

---

## 참고

- [가상 면접 사례로 배우는 대규모 시스템 설계 기초](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788966263158)
