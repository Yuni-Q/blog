---
title: 2장 리팩터링 깊에 들여다보기
date: 2023-07-16 23:07:35
category: five lines of code
tags: []
draft: true
---

## 이번 장에서 다룰 내용

- 가독성을 통한 의도 전달
- 유지보수성 개선을 위한 불변속성(invariant) 지역화
- 개발 속도 향상을 위한, 추가(addition)를 통해 변경 가능하게 만들기
- 리팩터링의 일상 업무화

## 2.1 가독성 및 유지보수성 향상

- 더 나은 코드를 만드는 것과 코드가 하는 일을 변경하지 않는다.

### 2.1.1 코드 개선

#### 가독성

- 가독성은 의도를 전달하기 위한 코드의 성질입니다.
  - 코드가 의도한 대로 전달한다는 가정이 있으면 코드가 무슨 일을 하는지 파악하기가 매우 쉽습니다.
- 코드에서 의도를 전달하는 방법
  - 코딩 컨벤션을 지정하고 따르는 것
  - 주석 달기
  - 변수
  - 메서드
  - 클래스 및 파일 이름 지정
  - 공백 사용

#### 유지보수성

- 유지보수성은 얼마나 많은 후보를 조사해야 하는지를 나타내는 표현입니다.
  - 버그를 고치거나 기능을 추가하기 위해 일부 기능을 변경해야 할 때마다 새 코드를 어디에 놓을지 후보 위치를 조사하는 것으로 시작합니다. 현재 코드가 무슨 일을 하는지 파악하고, 새로운 목표를 수용하기 위해 코드를 안전하고 빠르며 쉽게 수정할 수 있는 방법은 무엇인지 찾으려고 시도합니다.
  - 읽고 살펴봐야 할 코드가 많을수록 시간이 더 오래 걸리고 무언가를 놓칠 가능성이 높다는 것은 쉽게 알 수 있습니다. 따라서 유지보수성은 변경 시 발생하는 위험과 밀접하게 관련되어 있습니다.
- 어떤 시스템에서는 한군데서 무언가를 수정하면 관련 없어 보이는 다른 곳에서 문제가 발생합니다. 그런 시스템을 `취약하다(fragile)`고 말합니다.
  - 이 취약성의 군원은 일반적으로 `전역상태(global state)`입니다. 전역상태를 생각하는 데 도움이 되는 유용한 트릭은 중괄호를 찾는 것입니다.
  - 전역상태의 문제는 내부 변수에 외부의 데이터를 할당하는 경우가 많아서 데이터가 연결된 다른 변수를 통해 데이터를 손상 시킬 수 있습니다.
  - '함께 변하는 것은 함께 있어야 한다'는 의미의 `불변속성의 범위 제한(localizing invariants)` 통해 문제를 해소할 수 있습니다.

### 2.1.2 코드가 하는 일을 바꾸지 않고 유지보수하기

- 리팩터링을 할 때는 블랙박스의 경계를 고려해야 합니다.
  - 코드를 `블랙박스`로 생각하고 외부에 영향을 주지 않는 내부의 모든 작업을 변경할 수 있다고 생각할 수 있습니다.
- 리팩터링 중에는 코드가 느려져도 거의 신경 쓰지 않습니다.
  - 첫째, 대부분의 시스템에서 성능은 가독성과 유지보수성보다 가치가 떨어집니다.
  - 둘째, 성능이 중요한 경우 프로파일링 도구나 성능 전문가의 지도를 받아 리팩터링과 다른 단계에서 처리해야 합니다.

#### 리팩터링의 세 가지 핵심

1. 의도를 전달함으로써 가독성 향상
2. 불변속성의 범위제한을 통한 유지보수성 향상
3. 범위 밖의 코드에 영향을 주지 않고 1항과 2항을 수행

## 2.2 속도, 유연성 및 안정성 확보

### 2.2.1 상속보다는 컴포지션 사용

- 우리가 설명하는 대부분의 리팩터링 패턴과 규칙은 구체적으로 `객체 컴포지션`을 돕기 위한 것들입니다.
- 상속을 통해 기능을 구현 시 메소드를 재정의(override)해야 한다는 것을 잊을 수 있습니다.
  - (근데 이건 상속을 잘못 사용한 것이 아닐지...)

#### 유연성

- 컴포지션을 중심으로 만들어진 시스템을 사용하면 다른 방식보다 더 깔끔하게 코드를 결합하고 재사용 할 수 있습니다.

### 2.2.2 수정이 아니라 추가로 코드를 변경

- 컴포지션의 가장 큰 장점은 `추가(addition)`로 변경이 가능하다는 것입니다.
- `개방-폐쇄(open-close) 원칙`이라고 하며, 소프트웨어 구성 요소들은 확장에 대해 열려 있어야 하고, 수정에 대해 닫혀 있어야 합니다.

#### 프로그래밍 속도

- 어떤 코드가 사용되지 않는지 주의를 기울이고 사용되지 않는 코드는 최대한 빨리 삭제해야 합니다.

### 안정성

- 추가에 의한 변경 방식을 따르면 기존 코드를 항상 보존할 수 있습니다. 새 코드가 실패할 경우 이전 기능으로 대체하는 기능을 구현하는 것이 쉽습니다.

## 2.3 리팩터링과 일상 업무

- 레거시 시스템에서는 변경하기 전에 먼저 리팩터링하십시오. 그런 다음 작업 절차를 따르십시오.
- 코드를 변경한 후에도 리팩터링하십시오.
- "항상 여러분이 왔을 때보다 더 좋게 만들어 놓고 떠나세요"(보이스카우트 규칙)

### 2.3.1 학습 방법으로서의 리팩터링

- 더 나은 코드를 보고 경험하는 것은 코드를 작성하고 생각하는 방식을 바꿉니다.
- 안정성이 더 확보되면 이 안정성을 어떻게 활용할 수 있을지 생각하기 시작하비다.
- 리팩터링은 코드를 연구하는 완전히 다른 방식입니다.

## 2.4 소프트웨어 분야에서 '도메인' 정의하기

- 소프트웨어는 실행활의 특정 측면을 모델링한 것입니다. 소프트웨어와 대응되는 실세계는 항상 존재합니다. 이 실제 세계의 구성요소를 소프트웨어의 `도메인`이라고 합니다.
  - 도메인에는 흔히 사용자와 전문가, 고유한 용어, 그리고 고유한 문화가 있습니다.
- 프로그래밍은 주로 학습과 의사소통에 관한 것입니다.

## 요약

- 리팩터링은 기능 변경 없이 코드의 의도를 전달하고 불변속성의 범위를 제한하는 것입니다.
- 상속보다 컴포지션을 사용함으로써, 추가를 통한 변경으로 개발 속도, 유연성, 안정성을 확보합니다.
- 리팩터링을 일상 업무에 포함시켜 기술 부채가 쌓이지 않도록 해야 합니다.
- 리팩터링을 연습하면 코드에 대한 독특한 관점을 얻을 수 있으며, 이로 인해 더 나은 해결책을 찾을 수 있습니다.

---

- [파이브 라인스 오브 코드](https://product.kyobobook.co.kr/detail/S000200661796)
