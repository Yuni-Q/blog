---
title: dependency injection pattern
date: 2021-04-15 10:04:93
category: design pattern
tags: [design pattern]
draft: true
---

## Object Dependencies(객체 의존성)

- 현재 객체가 다른 객체와 상호작용(참조)하고 있다면 현재 객체는 다른 객체에 의존성을 가집니다.
- 하나의 모듈이 바뀌면 의존한 다른 모듈까지 변경 되어야 합니다. 또한 두 객체 사이의 의존성이 존재하면 Unit Test 작성이 어려워집니다.
- `의존성`은 서비스로 사용할 수 있는 객체입니다.

## Dependency Injection(의존성 주입)

- 의존성 주입은 `역 제어(Inversion of Control, IOC) 테크닉의 한 형태`로 어떤 서비스를 호출하려는 컴포넌트는 그 서비스가 어떻게 구성되었는지 알지 못해야 합니다.
- 클라이언트가 어떤 서비스를 사용할 것인지 지정하는 대신, 클라이언트에게 무슨 서비스를 사용할 것인지를 말(주입)해주는 것이다.
  - `주입`은 의존성(서비스)을 사용하려는 객체(클라이언트)로 전달하는 것을 의미합니다. 서비스는 클라이언트 상태의 일부입니다. 클라이언트가 서비스를 구축하거나 찾는 것을 허용하는 대신 클라이언트에게 서비스를 전달하는 것이 패턴의 기본 요건입니다.
- 클래스 간의 의존관계가 있을 때 `컴파일 타임의 의존관계를 제거`하고 `런타임 의존관계`로 만들어 주고 `결합도(coupling)을 낮춰주는 것`이 Dependency Injection입니다.
- 컴포넌트는 서비스 제공에 대한 책임을 `외부 코드(Injector)에게 위임`하고 Injector는 이미 존재하거나 Injector에 의해 생성된 서비스를 컴포넌트에게 주입하고 컴포넌트는 서비스를 사용합니다. 이는 `컴포넌트가 Injector와 서비스에 대해 알 필요가 없음`을 의미합니다. 컴포넌트는 서비스의 인터페이스에 대해서만 알면 되고 이는 `구성의 책임으로부터 사용의 책임을 구분`합니다.
- Dependency Injection은 프로그램의 디자인이 `느슨하게 커플링`되도록 하고, `의존관계 역전 원칙(Dependency Inversion Principle)`과 `단일 책임 원칙(single responsibility principles)`을 따르도록 클라이언트의 생성에 대한 의존성을 클라이언트의 행위로부터 분리하는 것입니다. 이는 클라이언트가 의존성을 찾기 위해 그들이 사용하는 시스템에 대해 알도록 하는 서비스 로케이터 패턴(service locator pattern)과 정반대되는 것입니다.
- 의존성 주입은 컴포지션을 통해 IoC를 구현하므로 종종 전략 패턴과 동일하지만, 전략 패턴의 의도는 객체의 수명동안 의존성을 교환할 수 있도록 하는 것이고, 의존성 주입에서는 단일 의존성 인스턴스만 사용할 수 있도록 하는 것입니다.
  - 싱글톤과 전략패턴과 연관이 있어 보입니다.

### SRP(Single Responsibility Principle, 단일 책임 원칙)

- 소프트웨어의 설계 부품은 단 하나의 책임만을 가져야 합니다.
- 즉 소프트웨어를 수정할 이유가 오직 하나여야 합니다.

### DIP(Dependency Inversion Principle, 의존관계 역전 원칙)

- 첫 번째, 상위 모듈은 하위 모듈에 의존해서는 안 됩니다. 둘 다 `추상화`에 의존해야 합니다.
- 두 번째, 추상화는 `세부사항에 의존하지 않습니다`. 세부사항이 추상화에 의존하여 달라져야 합니다.
- 의존 관계를 맺을 때, 변화하기 쉬운 것보단 변화하기 어려운 것에 의존해야 합니다.
  - 이때 변화하기 쉬운 것이란 구체적인 것을 말하고, 변화하기 어려운 것이란 추상적인 것을 말합니다.
  - 객체지향 관점에서 변화하기 쉬운 것이란 구체화된 클래스를 말하고, 변화하기 어려운 것이란 인터페이스를 의미합니다.
- DIP를 만족한다는 것은 의존관계를 맺을 때, 상위 모듈(클라이언트 클래스)는 하위 모듈(서비스 클래스)이 되는 구체적인 클래스보다 인터페이스나 추상 클래스와 관계를 맺는다는 것을 의미합니다.
- DIP를 만족하면 Dependency Injection 패턴을 적용해서 변화에 유연한 설계를 할 수 있습니다.
- 이 원칙은 `상위와 하위 객체 모두가 동일한 추상화에 의존해야 한다`는 객체 지향적 설계의 대원칙을 제공합니다.
- DI는 `DIP를 구현하는 기법중 하나라`고 생각 할 수 있습니다.
  - DI는 의존성을 어떻게 가질 것인가? DIP는 실체에 의존할 것인가, 추상화에 의존할 것인가의 문제라고 생각됩니다.

### IoC(제어의 역전)

- 역제어(IoC)는 DI보다 더 일반적입니다.
- 객체 자체가 아니라 `Framework에 의해 객체의 의존성이 주입되는 설계 패턴`입니다. Framework에 의해 동적으로 주입되므로 여러 객체 간의 결합이 줄어듭니다.
- IoC는 호출을 요구하는 대신 다른 코드가 호출할 수 있게 함을 의미합니다.
- 제어 반전, 제어의 반전, 역제어는 프로그래머가 작성한 프로그램이 재사용 라이브러리의 흐름 제어를 받게 되는 소프트웨어 디자인 패턴을 말합니다. 줄여서 IoC(Inversion of Control)이라고 부릅니다. 전통적인 프로그래밍에서 흐름은 프로그래머가 작성한 프로그램이 외부 라이브러리의 코드를 호출해 이용합니다. 하지만 제어 반전이 적용된 구조에서는 외부 라이브러리의 코드가 프로그래머가 작성한 코드를 호출합니다. 설계 목적상 제어 반전의 목적은 다음과 같습니다.
  - 작업을 구현하는 방식과 작업 수행 자체를 분리합니다.
  - 모듈을 제작할 때, 모듈과 외부 프로그램의 결합에 대해 고민할 필요 없이 모듈의 목적에 집중할 수 있습니다.
  - 다른 시스템이 어떻게 동작할지에 대해 고민할 필요 없이, 미리 정해진 협약대로만 동작하게 하면 됩니다.
  - 모듈을 바꾸어도 다른 시스템에 부작용을 일으키지 않습니다.
- 이 관계에서 제어가 역전되었다고 표현하는데 같은 맥락에서 `팩토리 메소드`와 `템플리 메소드 패턴` 역시 IoC를 설명하는 예 중 하나입니다.
- IoC는 제어의 역전에 관한 소프트웨어 용어로 `누가 작업을 수행하느냐`가 포인트입니다.

## 의존성 주입은 다음과 같은 문제를 해결합니다.

- 어떻게 애플리케이션이나 클래스가 객체의 생성 방식과 독립적일 수 있는가?
- 어떻게 객체의 생성 방식을 분리된 구성 파일에서 지정할 수 있는가?
- 어떻게 애플리케이션이 다른 구성을 지원할 수 있는가?

## 의존성 주입은 네 가지 역할을 포함한다.

- 사용될 서비스 객체
- 사용하는 서비스에 의존하는 클라이언트 객체
- 클라이언트의 서비스 사용 방법을 정의하는 인터페이스
- 서비스를 생성하고 클라이언트로 주입하는 책임을 갖는 주입자

## 의존성 주입 방법

- 생성자 주입 : 필요한 의존성을 모두 포함하는 클래스의 생성자를 만들고 그 생성자를 통해 의존성을 주입합니다.
- 세터(Setter)를 통한 주입 : 의존성을 입력받는 세터(Setter) 메소드를 만들고 이를 통해 의존성을 주입합니다.
- 인터페이스(Interface)를 통한 주입 : 의존성을 주입하는 함수를 포함한 인터페이스를 작성하고 이 인터페이스를 구현하도록 함으로써 실행시에 이를 통하여 의존성을 주입합니다.

## 장점

- 의존성 주입의 의도는 객체의 `생성과 사용의 관심을 분리`하는 것이다.
- 코드의 재사용성 증가 및 코드 단순화
  - 만약 특정 객체를 여러 클라이언트에서 의존한다면 각 클라이언트가 특정 객체를 모두 구현할 필요없이 서비스가 이를 한 번만 구현하여 여러 클라이언트에게 의존성을 주입해주어 효율적입니다.
- 리펙토링의 과정 수월
  - 특정 객체에 의존성이 존재하는 클라이언트와 특정 객체를 필요로하는 클라이언트에게 간접적으로 의존성을 주입하는 서비스의 모듈이 체계적으로 분리되어 리펙토링 과정에서 조금 더 수월합니다.
- 보일러 코드 감소
  - 특정 객체를 필요로하는 클라이언트가 직접적으로 그 객체를 구현하지 않고 주입 받는 형식으로 이루어지기 때문에 필요할 때만 데이터를 전달받아 보일러 코드와 같이 메모리 누수 현상을 막을 수 있습니다.
- 프로그램 테스트 용이
  - 프로그램 내의 각 모듈들이 체계적으로 분리되어 Unit Test를 보다 더 쉽게 진행할 수 있습니다.

---

## 참고

- [\[Design Pattern\] DI란 (Dependency Injection)](https://gmlwjd9405.github.io/2018/11/09/dependency-injection.html)
- [\[Design Pattern\] Dependency Injection](https://iamsjy17.github.io/design%20pattern/2020/05/30/designpattern_dependency_injection.html)
- [의존성 주입](https://ko.wikipedia.org/wiki/%EC%9D%98%EC%A1%B4%EC%84%B1_%EC%A3%BC%EC%9E%85)
- [Dependency Injection 디자인 패턴](https://juyeop.tistory.com/26)
- [\[디자인패턴\] IoC, DI, DIP 용어 정리](https://black-jin0427.tistory.com/194)
