---
title: 9장 운영 부담을 최소화하라
date: 2024-04-14 21:04:12
category: 이펙티브 엔지니어
tags: ['Part3 장기적인 가치를 구축하라']
draft: true
---

- 개발 비용은 출시와 함께 멈추는 것이 아니다. 오히려 바로 그때부터 쌓이기 시작하는 것으로 보아야 한다.
- 운영 비용을 최소화 하려면 매력적이거나 도발적인 신기술 대신 가능한 확고한 검증된 기술을 선택한다.

## 단순하게 운영하라

- 이펙티브 엔지니어는 단순하게 만드는 데 주력한다.
  - 단순한 해결책은 이해하고 유지 보수하고 수정하기 쉽기 때문에 운영 부담이 적다.

### 아키텍처가 너무 복잡하면 유지 보수 비용이 발생한다

- 다양한 시스템에 관한 엔지니어링 전문 지식을 습득해야 한다
- 복잡성이 증가하면 잠재적 단일 장애점이 늘어난다
- 신입 개발자가 새 시스템을 익히고 이해하기 어려워진다
- 추상화, 라이브러리, 도구를 개선하는 데 드는 노력이 여러 시스템으로 분산되어 희석된다.

## 빨리 실패하는 시스템을 만들어라

- 시스템이 느리게 실패하면 코드 오류의 원인이 불분명해져서 어떤 문제가 일어난 것인지 알아내기 어려워진다.
  - 느린 실패를 하게 하는 원인은 매개 변수를 기본값으로 설정하기, 예상치 못한 문제를 다루는 포괄적인 예외 처리기 추가하기, 예상치 못한 반환 값 조용히 무시하기 등이 있다.
- 빨리 실패하면 더 빠르고 효과적으로 문제를 드러내고 해결할 수 있다.
  - 시작할 때 설정 오류를 발견하면 바로 종료하기
  - 소프트웨어 입력 확인하기(오랜 시간이 지난 후에 사용되지 않을 예정이라면 더욱 중요함)
  - 다룰 줄 모르는 외부 서비스에서 발생한 오류를 무시하지 말고 표시하기
  - 컬렉션 같은 자료 구조의 특정 변경사항이 반복자 같은 종속적인 자료 구조를 사용할 수 없는 상태로 만들면 최대한 빨리 예외 발생시키기
  - 주요 데이터 구조가 손상됐을 때 시스템 내부로 손상이 더 전파하지 말고 예외 발생시키기
  - 복잡한 논리 흐름 전후에 주요 불변 값이 유지된다고 단언하고 자세한 오류 메시지 첨부하기
  - 유효하지 않거나 일관성이 없는 프로그램 상태에 대해 개발자에게 최대한 빨리 경고하기
- 시스템이 복잡할수도록 실패하기 기법은 더 많은 시간을 절약해준다.
- 빨리 실패하기 기법을 활용하여 문제를 즉시 드러내는 동시에 최대한 빨리 오류의 실제 원인에 최대한 가깝게 접근하라. 그리고 최종 사용자 측에서 우아하게 실패하는 동안 개발자에게 오류를 보고하는 전역 예외 처리기로 이를 보완하라.

## 기계적인 작업을 꾸준히 자동화하라

- 시간은 가장 가치 있는 자원이다.

### 자동화가 도움이 되는 활동

- 코드, 인터렉션, 시스템이 예상대로 작동하는지 확인하기
- 데이터 추출하고 변환하고 요약하기
- 오류율 급증 감지하기
- 새 장비에 소프트웨어 빌드하고 배포하기
- 데이터베이스 스냅숏 캡처하고 저장하기
- 주기적으로 배치 계산 실행하기
- 웹 서비스 재시작하기
- 코드가 스타일 가이드라인을 준수하는지 확인하기
- 머신 러닝 모델 트레이닝하기
- 사용자 계정이나 사용자 데이터 관리하기
- 서비스 그룹에 서버를 추가하거나 제거하기

### 똒독한 자동 의사 결정이라는 훨씬 더 어려운 문제는 수비게 달성할 수 있는 목표를 달성한 후에 착수하는 것이 좋다

## 일괄 처리를 멱등성 있게 만들어라

- 일괄 처리를 '유지 보수하기 쉽고 실패 회복력이 더 뛰어나게' 만드는 한 가지 기법은 이를 멱등성 있게 만드는 것이다.
  - 멱등성 있는 프로세스란 실행을 한 번 하든 여러 번 하든 상관없이 똑같은 결과를 생성하는 프로세스다.
- 멱등성 있게 만들 수 없다면 적어도 일괄 처리를 재시도하거나 재진입할 수 있도록 구성하는 것이 도움이 된다.
  - 재시도하거나 재진입 할 수 있는 프로세스란 이전에 중단된 호출을 성공적으로 완료할 수 있는 프로세스다.
  - 불일치 상태를 처리할 줄 아는 프로세스를 설계하면 나중에 요구되는 수작업의 양을 줄일 수 있다.
  - 각 프로세스가 완전히 성공하거나 완전히 실패하게 하라.
- 멱등성 있는 스크립트에서는 사용 빈도가 낮은 작업 흐름의 드라이 런 실행을 매일 또는 매주 예약해서 사용 빈도가 더 높은 작업 흐름으로 변환하는 강력한 기법을 활용할 수 있다. 그러면 무언가 망가졌을 때 더 빨리 피드백을 받을 수 있다.
  - 드라이 런: 테스트 등의 목적으로 프로그램을 실행하는 행위
- 멱등성, 재진입성을 갖추면 자동 처리, 일괄 처리의 유지 보수에 수반되는 복잡성과 반복해서 발생하는 비용이 줄어든다.

## 신속하게 대응하고 복구하는 능력을 강화하라

- 예기치 못한 큰 실패에 대한 최선의 방어책은 자주 실패하는 것이다.
- 예기치 못한 상황에 대비할 수 있는 실패와 재난을 시뮬레이션하는 전력을 활용하고 있다.
- 빠르게 복구하는 능력을 키우기 위해 실패 시나리오를 연습한다.
- 우리가 할 수 있는 최선은 '성공을 위한 대본'을 작성하고, 실패 시나리오를 연습하고, 신속하게 복구하는 능력을 기르는 것이다.

### '만약에'라는 질문을 던지고 각각 상황에 대해 비상 대책을 세워라

- 만약에 심각한 버그가 배포된다면 어떻게 할까? 얼마나 빨리 롤백하거나 수정할 수 있을까? 또는 그 시간을 단축할 수 있을까?
- 만약에 데이터베이스 서버에 장애가 발생한다면 어떻게 할까? 다른 장비로 대체하여 장애를 극복하고 손실된 데이터를 복구하려면 어떻게 해야 할까?
- 만약에 서버 과부하가 발생하면 어떻게 할까? 증가한 트래픽을 처리할 수 있게 확장할 방법은 무엇일까? 아니면 일부 요청에라도 올바르게 응답할 수 있도록 부하를 없애려면 어떻게 해야 할까?
- 만약에 테스트 환경이나 스테이징 환경에 문제가 있으면 어떻게 할까? 어떻게 새로운 환경을 구성할 수 있을까?
- 만약에 고객이 긴급한 문제를 보고하면 어떻게 할까? 고객지원팀이 엔지니어링 팀에게 이를 알리는 데 얼마나 걸릴까? 엔지니어링 팀이 수정하는 데는 얼마나 걸릴까?

### 빠르게 복구할 수 있게 실패 시나리오를 연습하면 소프트웨어 엔지니어링의 다른 측면에서도 도움이 된다

- 만약에 관리자나 다른 이해관계자가 비정기적인 리뷰 회의에서 제품 계획에 이의를 제기하면 어떻게 할까? 어떤 질문이 나올 수 있으며 어떻게 답해야 할까?
- 만약에 핵심 팀원이 아프거나 사고를 당하거나 퇴사하면 어떻게 할까? 팀이 계속 정상적으로 작동하려면 어떻게 인수인계를 받아야 할까?
- 만약에 사용자들이 논란의 여지가 있는 새로운 기능을 반대하면 어떻게 할까? 어떤 입장을 취할 것이며 얼마나 빨리 대응할 수 있을까?
- 만약에 프로젝트가 약속한 기한을 지키지 못하면 어떻게 할까? 어덯게 하면 지연을 빨리 예측하고 복구하고 대응할 수 있을까?

## 핵심 요역

- 간단한 것부터 하라.
- 빨리 실패하면 오류의 원인을 정확히 찾을 수 있다.
- 의사 결정보다 매커니즘을 자동화하라
- 멱등성과 재진입성을 추구하라
- 고장 유형을 계획하고 연습하라

---

## K: 적정 기술인지 고민하고 쓰자

- A: 적정 기술을 선정하는 기준을 마련해 보자

## K: 개발자는 개발을 하는 사람이 아니라 문제를 해결하는 사람이다. 코드를 쓰지 않고 문제를 해결하면 유지보수 할 것도 없다.

- A: 많이 공론화 해보자

## K: 오버스펙을 경계하자. 서버를 구현하기 앞서 구글스프레드시트를 사용해 보는 것도 좋다

## K: 단순화하기 위해 노력하자

- A: 단순화를 위한 체크리스트를 만들자

## K: 도구의 사용법은 다양할 수 있다. 스프레드시트를 디비로 쓰는 것처럼

## K: 에러의 발생 지점을 명확히 하는 것이 좋다

- A: try catch에 너무 많은 로직을 한번에 넣지 말자
- A: 에러가 난 곳을 독립적으로 끊어서 관리하자

## K: 빨리 실패할 수 있는 방법은 다양하게 있으니 잘 활용해 보자

- A: 타입으로 컴파일 타임
- A: 테스트로 작은 파일부터 큰 파일까지

## K: 의사결정 자동화에 있어서 공유지의 비극이 많이 일어나는거 같다.

- A: 모르겠다... 고민해보자...

## K: 멱등성에 대해 잘 알고 테스트에 활용하면 좋다.

## K: 모의 장애 훈련 같은 교육은 도움이 많이 된다.
