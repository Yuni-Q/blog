---
title: 8장 타입스크립트로 마이그레이션 하기
date: 2021-08-25 01:08:97
category: 이펙티브 타입스크립트
tags: []
draft: true
---

## 아이템 58 : 모던 자바스크립트로 작성하기

- 타입스크립트 개발 환경은 모던 자바스크립트도 실행할 수 있으므로 모던 자바스크립트의 최신 기능들을 적극적으로 사용하길 바랍니다. 코드 품질을 향상시킬 수 있고, 타입스크립트의 타입 추록도 더 나아집니다.
  - 옛날 버전의 자바스크립트 코드를 최신 버전의 자바스크립트로 바꾸는 작업은 타입스크립트로 전환하는 작업의 일부로 볼 수 있습니다.
  - 타입스크립트 개발팀은 자바스크립트 표준화 4단계 중 3단계 이상의 기능들을 타입스크립트 내에 구현하고 있습니다.
  - 타입스크립트를 도입할 때 가장 중요한 기능은 ECMAScript 모듈과 ES2015 클래스 입니다.
- 타입스크립트 개발 환경에서는컴파일러와 언어 서비스를 통해 클래스, 구조 분해, async/await 같은 기능을 쉽게 배울 수 있습니다.
- 'use strict'는 타입스크립트 컴파일러 수준에서 사용되므로 코드에서 제거해야 합니다.
- TC39의 깃헙 저장소와 타입스크립트의 릴리스 노트를 통해 최신 기능을 확인할 수 있습니다.

### ECMAScript 모듈 사용하기

- ES2015 이전에는 코드를 개별 모듈로 분할하는 표준 방법이 없었지만, 지금은 개별 모듈로 분할하는 방법이 많아졌습니다.
  - 여러 개의 \<script> 태그를 사용하기, 직접 갖다 붙이기(manual concatenation), Makefile 기법, NodeJS 스타일의 require 구문, AMD 스타일의 define 콜백까지 다양합니다. 심지어 타입스크립트에도 자체적인 모듈 시스템이 있습니다.
- ES2015부터는 임포트(import)와 익스포트(export)를 사용하는 ECMAScript 모듈(또는 ES 모듈)이 표준이 되었습니다.
- ES 모듈 시스템은 타입스크립트에서도 잘 동작하며, 모듈 단위로 전환할 수 있게 해 주기 때문에 점직적 마이그레이션이 원할해집니다.

### 프로토타입 대신 클래스 사용하기

- 프로토타입으로 구현한 객체보다 클래스로 구현한 객체가 문법이 간결하고 직관적입니다.
- 클래스 문법이 익숙하지 않더라도 타입스크립트 언어 서비스를 활용하면 클래스를 간단히 작성할 수 있습니다.

### var 대신 let/const 사용하기

- var 대신 let과 const를 사용하면 스코프 문제를 피할 수 있습니다.
- 함수 표현식을 사용하여 호이스팅 문제를 피하는 것이 좋습니다.

### for(;;) 대신 for-of 또는 배열 메서드 사용하기

- for-of 코드가 짧고 인덱스 변수를 사용하지도 않기 때문에 실수를 줄일 수 있습니다.
- 인덱스 변수가 필요한 경우엔 forEach 메서드를 사용하면 됩니다.
- for-in 문법도 존재하지만 몇 가지 문제점이 있기 때문에 사용하지 않는 것이 좋습니다.

### 함수 표현식보다 화살표 함수 사용하기

- this 키워드는 일반적인 변수들과는 다른 스코프 규칙을 가지기 때문에, 자바스크립트에서 가장 어려운 개념 중 하나입니다. 일반적으로 this가 클래스 인스턴스를 참조하는 것을 기대하지만 예상치 못한 결과가 나오는 경우도 있습니다.
- 화살표 함수를 사용하면 상위 스코프의 this를 유지할 수 있습니다.
- 인라인(또는 콜백)에서는 일반 함수보다 화살표 함수가 더 직관적이며 코드도 간결해지기 때문에 가급적 화살표 함수를 사용하는 것이 좋습니다.
- 컴파일러 옵션에 NoImplicitThis(또는 strict)를 설정하면, 타입스크립트가 this 바인딩 관련된 오류를 표시해 주므로 설정하는 것이 좋습니다.

### 단축 객체 표현과 구조 분해 할당 사용하기

- 단축 객체 표현은 코드가 더 간결하고 중복된 이름을 생략하여 가독성이 좋고 실수가 적습니다.
- 구조 분해 문법에서는 기본값을 지정할 수도 있습니다. 단축 객체 표현과 마찬가지로, 객체 구조 분해를 사용하면 분법이 간결해지고 변수를 사용할 때 실수를 줄일 수 있기 때문에 적극적으로 사용하는 것이 좋습니다.

### 함수 매새변수 기본값 사용하기

- 자바스클비트에서 함수의 모든 매개변수는 선택적(생략 가능)이며, 매개변수를 지정하지 않으면 undefined로 간주됩니다.
- 모던 자바스크립트에서는 매개변수에 기본값을 직접 지정할 수 있습니다.
- 매개변수에 기본값을 지정하면 코드가 간결해질 뿐만 아니라 base가 선택적 매개변수라는 것을 명확히 나타내는 효과도 줄 수 있습니다.
- 기본값을 기반으로 타입 추론이 가능하기 때문에, 타이브크립트로 마이그레이션할 때 매개변수에 타입 구문을 쓰지 않아도 됩니다.

### 저수준 프로미스나 콜백 대신 async/await 사용하기

- async와 await를 사용하면 코드가 간결해져서 버그나 실수를 방지할 수있고, 비동기 코드에 타입 정보가 전달되어 타입 추론을 가능하게 합니다.

### 연관 배열에 객체 대신 Map과 Set 사용하기

- 인덱스 시그니처는 편리하지만, 몇 가지 문제점이 있습니다. 이를 방지하려면 Map을 사용하는 것이 좋습니다.

### 타입스크립트에 use strict 넣지 않기

- 'use strict'를 넣으면 엄격 모드가 활성화됩니다. 하지만 타입스크립트에서 수행되는 안전성 검사(sanity check)가 엄격 모드보다 훨씬 더 엄격한 체크를 하기 때문에, 타입스크립트 코드에서 'use strict'은 무의미 합니다.
- 실제로는 타입스크립트 컴파일러가 생성하는 자바스크립트 코드에서 'use strict'가 추가됩니다.
- alwaysStrict 또는 strict 컴파일러 옵션을 설정하면, 타입스크립트는 엄격 모드로 코드를 파싱하고 생성되는 자바스킯트에 'use strict'를 추가합니다. 즉, 타입스크립트 코드에 'use strict'를 쓰지 않고, 대신 `alwaysStrict` 설정을 사용해야 합니다.

## 아이템 59 : 타입스크립트 도입 전에 @ts-check와 JSDoc으로 시험해 보기

- 파일 상단에 // @ts-check를 추가하면 자바스크립트에서도 타입 체크를 수행할 수 있습니다.
- 전역 선언과 서드파티 라이브러리의 타입 선언을 추가하는 방법을 익힙시다.
- JSDoc 주석을 활용하면 자바스크립트 상태에서도 타입 단언과 타입 추론을 할 수 있습니다.
- JSDoc 주석은 중간 단계이기 때문에 너무 공들일 필요는 없습니다. 최종 목표는 .ts로 된 타입스크립트 코드임을 명심합니다.

### @ts-check

- @ts-check 지시자를 사용하여 타입 체커가 파일을 분석하고, 발견된 오류를 보고합니다. 그러나 @ts-check 지시자는 매우 느슨한 수준으로 타입 체크를 수행하는데, 심지어 noImplicitAny 설저응ㄹ 해제한 것보다 헐거운 체크를 수행합니다.
- @ts-check 지시자를 사용하면 불일치나 함수의 매개변수 개수 불일치 같은 간단한 오류 외에도, 몇 가지 의미 있는 오류들을 찾아낼 수 있습니다.
  - 선언되지 않은 전역 변수
  - 알 수 없는 라이브러리
  - DOM 문제
  - 부적확한 JSDoc

## 아이템 60 : allowJs로 타입스크립트와 자바스크립트 같이 사용하기

- 점진적 마이그레이션을 위해 자바스크립트와 타입스크립트를 동시에 사용할 수 있게 allowJs 컴파일러 옵션을 사용합니다.
- 대규모 마이그레이션 작업을 시작하기 전에, 테스트와 빌드 체인에 타입스크립트를 적용해야 합니다.
  - 타입스크립트로 마이그레이션하는 동시에 빌드와 테스트가 동작하게 하는 것이 힘들기는 하지만, 제대로 된 점직적 마이그레이션을 시작하기 위해 반드시 필요합니다.

## 아이템 61 : 의존성 관계에 따라 모듈 단위로 전환하기

- 마이그레이션의 첫 단계는, 서드파티 모듈과 외부 API 호출에 대한 @types를 추가하는 것입니다.
- 의존성 관계도의 아래에서부터 위로 올라가며 마이그레이션을 하면 됩니다. 첫 번째 모듈은 보통 유틸리티 모듈입니다. 의존성 관계도를 시각화하여 진행 과정을 추적하는 것이 좋습니다.
- 이상한 설계를 발견하더라도 리팩터링을 하면 안됩니다. 마이그리에션 작업은 타입스크립트 전환에 집중해야 하며, 나중에 리팩터리을 위해 목록을 만들어 두는 것이 좋습니다.
- 타입스크립트로 전환하며 발견하게 되는 일반적인 오류들을 놓치지 않아야 합니다. 타입 정보를 유지하기 위해 필요에 따라 JSDoc 주석을 활용해야 할 수도 있습니다.
- 마지막 단계로, 테스트 코드를 타입스크립트로 전환하면 됩니다. 로직 코드가 테스트 코드에 의존하지 않기 때문에, 테스트 코드는 항상 의존성 관계도의 최상단에 위치하며 마이그레이션의 마지막 단계가 되는 것은 자연스러운 일입니다.

### 타입스크립트로 전환하며 발견하게 되는 일반적인 오류들

- 선언되지 않은 클래스 멤버 : 자바스크립트는 클래스 멤버 변수를 선언할 필요가 없지만, 타입스크립트에서는 명시적으로 선언해야 합니다.
- 타입이 바뀌는 값
- 자바스크립트 상태에서 JSDoc과 @ts-check를 사용해 타입 정보를 추가한 상태라면, 타입스크립트로 전환하는 순간 타입 정보가 `무효화`된다는 것을 주의해야 합니다.

## 아이템 62 : 마이그레이션의 완성을 위해 noImplicitAny 설정하기

- noImplicitAny 설정을 활성화하여 마이그레이션의 마지막 단계를 진행해야 합니다. noImplicitAny 설정이 없다면 타입 선언과 관련된 실제 오류가 드러나지 않습니다.
- noImplicitAny를 전면 적용하기 전에 로컬에서부터 타입 오류를 점진적으로 수정해야 합니다. 엄격한 타입 체크를 적용하기 전에 팀원들이 타입스크립트에 익숙해질 수 있도록 시간을 줍니다.

### 타입 체크의 강도를 높이는 설정

- noImplicitAny는 상당히 엄격한 설정입니다.
- strictNullChecks 같은 설정을 적용하지 않더라도 대부분의 타입 체크를 적용한 것으로 불 수 있습니다.
- 최종적으로 가장 강력한 설정은 `"strict": true`입니다.
