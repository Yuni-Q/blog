---
title: 8장 URL 단축기 설계
date: 2022-09-04 19:09:73
category: 가상 면접 사례로 배우는 대규모 시스템 설계 기초
tags: []
draft: true
---

## 301 Permanently Moved

- 이 응답은 URL에 대한 HTTP 요청의 처리 책임이 영구적으로 Location 헤더에 반환된 URL로 이전되었다는 응답입니다. 영구적으로 이전되었으므로, 브라우저는 이 응답을 캐시(cache)합니다. 따라서 추후 같은 단축 URL에 요청을 보낼 필요가 있을 때 브라우저는 캐시된 원래 URL로 요청을 보내게 됩니다.
- 서버 부하를 줄이는 것이 중요하면 301 Permanently Moved를 사용합니다. 첫 번째 요청만 단축 URL 서버로 전송될 것입니다.

## 302 Found

- 이 응답은 주어진 URL로의 요청이 `일시적으로` Location 헤더가 지정하는 URL에 의해 처리되어야 한다는 응답입니다. 따라서 클라이언트의 요청은 언제나 단축 URL 서버에 먼저 보내진 후에 원래 URL로 리디렉션 되어야 합니다.
- 트래픽 분석(analytics)이 중요할 때는 302 Found를 쓰는 쪽이 클릭 발생률이나 발생 위치를 추적하는 데 좀 더 유리할 것입니다.

## URL 리디렉션

- URL 리디렉션을 구현하는 가장 직관적인 방법은 해시 테이블을 사용하는 것입니다.
- 원래 URL=hashTable.get(단축 URL)
- 301 또는 302 응답 Location 헤더에 원래 URL을 넣은 후 전송

## 해시 함수 구현에 쓰일 기술

### 해시 충돌 후 충돌 해소

- 긴 URL을 줄이려면, 원래 URL을 7글자 문자열로 줄이는 해시 함수가 필요합니다. 손쉬은 방법은 CRC32, MD5, SHA-1 같이 잘 알려진 해시 함수를 이용하는 것입니다. 해시 값에서 7개 글자만 이용하고 충돌이 해소될 때까지 사전에 정한 문자열을 해시값에 덧붙입니다.
- 이 방법을 쓰면 충돌은 해소할 수 있지만 단축 URL을 생성할 때 한번 이상 데이터베이스 질의를 해야 하므로 오버헤드가 큽니다.
- 데이터 베이스 대신 블룸 필터를 사용하면 선능을 높일 수 있습니다.

### base-62 변환

- 진법 변환(base conversion)은 URL 단축기를 구현할 때 흔히 사용되는 접근법 중 하나입니다.
- 62진법을 쓰는 이유는 hash Value에 사용할 수 있는 문자(character) 개수가 62개이기 떄문입니다.

### 비교

| 해시 후 충돌 해소 전략                                                                    | base-62 변환                                                                                                                 |
| ----------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| 단축 URL의 길이가 고정됨                                                                  | 단축 URL의 길이가 가변적, ID 값이 커지면 같이 길어짐                                                                         |
| 유일성이 보장되는 ID 생성기가 필요치 않음                                                 | 유일성 보장 ID 생성기가 필요                                                                                                 |
| 충돌이 가능해서 해소 전략이 필요                                                          | ID의 유일성이 보장된 후에야 적용 가능한 전략이라 충돌은 아예 불가능                                                          |
| ID로부터 단축 URL을 계산하는 방식이 아니라서 다음에 쓸 수 있는 URL을 알아내는 것이 불가능 | ID가 1씩 증가하는 값이라고 가정하면 다음에 쓸 수 있는 단축 URL이 무엇인지 쉽게 알아낼 수 있어서 보안상 문제가 될 소지가 있음 |

## 추가 사항

- 처리율 제한 장치(rate limiter): 처리율 제한 장치를 두면, IP 주소를 비롯한 필터링 규칙(filtering rule)들을 이용해 요청을 걸너낼 수 있을 것입니다.
- 웹 서버의 규모 확장
- 데이터베이스의 규모 확장
- 데이터 분석 솔루션(analytics)
- 가용성, 데이터 일관성, 안정성

---

## 참고

- [가상 면접 사례로 배우는 대규모 시스템 설계 기초](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788966263158)
