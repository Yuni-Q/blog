---
title: AWS Global Infrastructure
date: 2022-12-06 20:12:12
category: infra
tags: []
draft: true
---

# AWS Global Infrastructure Overview

## AWS 리전 설계

- aws 리전은 더 높은 가용성, 확장성, 내결함성을 위해서 다중의 가용영역으로 구성
- 어플리케이션과 데이터는 다른 가용역역 간에 실시간 복제가 되며 일관성을 가짐

### 리전

- 설명 추가

### 가용 영역

- 설명 추가

## 가용 영역 설계

- 완전히 격리된 하나 이상의 데이터 센터
- 충분한 물리적 거리
- 자가 전력 인프라
- 수십만 대 규모의 서버
- 완전히 격리된 다중 metro fiber

## 콘텐츠 전송 네트워크(CDN)

- 최종 사용자에게 더 짧은 지연 시간으로 컨텐츠를 제공하기 위해 Amazon CloudFront는 230+개의 Points fo Presences 글로벌 네트워크를 이용합니다.

## 글로벌 네트워크

- 글로벌 네트워크: 네트워크는 대양 횡단 케이블로 연결된 이중화된 100GbE로 구축
- 전용 연결(Direct Connect): 데이터 센터 사무실 또는 코로케이션 환경과 AWS 리전 사이에서 직접 비즈니스 크리티컬 데이터를 상호 전송

## AWS 보안: 책임 공유 모델

- 클라우드 환경 자체에 대한 책임
- 클라우드 환경 위에 올라가는 보안에 대한 책임

## 이점(Low cost)

- 보안
- 가용성
- 성능
- 확장성
- 유연성

# AWS Network

## AWS VPC 개요

- Virtual Private Cloud
- 사용자가 정의한 가상의 네트워크 공간
- 완전한 네트워크 제어 가능
  - IP 범위
  - Subnet
  - Route Table
  - Network ACL, 보안 그룹
  - 다양한 게이트웨이
- VPC 내의 모든 EC2 인스턴스들은 사설 IP가 부여
- 개별 인스턴스에 공인 IP 할당 가능

### Public IP / Elastic IP

- Public IP
  - 유동 IP 주소
- Elastic IP
  - 고정 IP 주소
  - Amazon EIP 주소 풀 또는 Bring Your Own IP(BYOIP)

## VPC 기본 구성

### 리전 선택

- 리전 레벨에서의 서비스

### 주소 범위

- 사이더 포맷으로 설정
- 10.0.0.0/16
  - 권장 대역: RFC 1918 대역
  - CIDR 포맷: (/16 = 65536)
- 사설 IP 대역(RFC 1918 참고) 사용 권고
- 주 주소 범위 (CIDR 블록)은 생성 후 변경 불가능
  - 보조 CIDR 블록 생성/제거 가능
- 생성 가능한 CIDR 블록 범위는 /28(16) ~ / 16(65536)
- 향후 직접 연결할 가능성이 있는 네트워크와 주소가 중복되지 않도록 할당
  - PS - Z or A - N 영역 간의 연결

### 서브넷

- 가용 영역 내의 서비스
- VPC 내애서 용도별로 더 쪼개서 사용하는 IP 범위
- 고가용성을 위해서도 서브넷을 사용
- VPC CIDR 블록 범윙에서 가용영역 별 세부 서브스 정의 가능
  - 서브넷 범위는 보통 /24(256) 이상을 권고
  - 5개의 주소는 (처음 4개, 마지막 1개)는 예약된 주소로 사용 불가
- 서브넷 종류
  - 퍼블릭 서브넷
  - 프라이빗 서브넷
- 서브넷 생성 후, 주소 범위 변경 불가능

### 라우팅 테이블

- 표지판 역할
- 주 라우팅 테이블 / 커스텀 라우팅 테이블
- 라우팅 테이블
  - 서브넷 단위로 설정
  - 네트워크 트래픽이 향하는 방향을 결정해 주는 규칙 세트
  - Destination과 Target 명시
- VPC 내에 생성된 모든 서브넷은 기본적으로 로컬 라우터를 통해 상호 통신
- 그 외의 경우, 추가적인 라우팅 규칙 설정 필요
  - 인터넷, 새나 VPC 통신 및 전용선 등
- 서브넷에 별도 라우팅 테이블을 지정하지 않으면, 주 라우팅 테이블 할당

### 트래픽 제어

- ACL
  - 서브넷 단위
  - Allow / Deny 규칙
  - 응답 트래픽에 대한 명시적 허용 필요(=stateless)
- 보안 그룹
  - 인스턴스 단위
  - Allow 규칙
  - 응답 트래픽에 대한 자동 허용(=stateful)

## 게이트웨이 서비스

### 인터넷 게이트웨이

- VPC와 인터넷 간에 통신을 도와줌
- 인터넷 라우팅이 가능한 트래픽에 대한 VPC 라우팅 테이블에 대상을 제공

### NAT 게이트웨이

- 프라이빗 서브넷에 위치한 인스턴스의 라이브러리 설치, 패치 및 업데이트 등 수행
- 인터넷 통신을 위해 NAT 게이트웨이당 하나의 Elastic IP 필요
- 외부에서는 들어올 수 없다.

## 환경별 VPC 환경

### VPC간 연결 방법

- 인터넷 게이트웨이
- VPC Peering
  - VPC 간 완전히 격리된 전용 연결
    - 서로 다른 리전의 VPC 간 전용 연결
    - 다른 계정의 VPC 간 전용 연결
  - VPC 간 단일 Peering만 가능, VPC 주소 범위는 중복 불가
  - Transit이 지원되지 않는 VPC Peering
- Transit Gateway
  - 수 많은 VPC를 쉽고 자유롭게 연결
  - 지점/지사 네트워크를 손쉽고 단순하게 통합
  - 라우팅 도메인을 활용한 다양한 구성
- VPC Endpoint
  - 엔드 포인트
    - 인터넷을 경유하지 않고 AWS 서비스 사용
    - VPC와 해당 자우너 간 전용 연결(NAT이나 IGW 불필요)
  - 엔드 포인트 종류
    - 게이트웨이 엔드포인트(S3, Dynamo DB)
    - 인터페이스 엔드포인트(다양한 AWS 서비스들)
    - 게이트웨이 로드밸런서 엔드포인트(게이트웨이 로드밸런서)

## 트래픽 모니터링

### VPC flow logs

- VPC, 서브넷, EC2 인스턴스 ENI 단위로 적용 가능한 패킷 헤더 및 기타 메타데이터 수집
- 생성되는 모든 패킷에 대한 정보를 S3 또는 CloudWatch Logs에 기록
- 로깅할 트팩 선택 가능
  - 필터 종류: 수락된 트래픽, 거부된 트래픽, 둘 다 수집
- 최대 집계 간격 1분 똔느 10분 단위로 선택 가능

# Compute

- AMAZON EC2: 클라우드 환경에서의 가상 서버 서비스
- AMAZON ECS, EKS, and FARGATE: EC2 기반 managed cluster 위에서 도커를 관리하기 위한 컨테이너 관리 서비스
- AWS LAMBDA: 이벤트, 외부 요청 또는 일정에 다라 실행되는 코드 위한 서버리스 서비스

## Amazon Elastic compute Cloud(EC2)

- 호스트 서버 위 하이퍼바이저 위 게스트
- EBS: 네트워크로 연결된 블록 스토리지
- 호스트 위에 같이 있는 인스턴스 스토어도 있다.

## Amazon Machine Image(AMI)

- 인스턴스를 Launch 할 때 필요한 정보를 제공
- 하나의 AMI로 여러 개의 인스천스를 시작 가능
- AMI에는 다음과 같은 정보가 있습니다
  - 루트 볼륨을 구성하는 템플릿(OS, 어플리케이션 등)
  - 인스턴스에 연결되는 불륨의 블록 디바이스 매핑
- 고객에게 보이지 않는 S3에 저장 -> 기반으로 인스터스 생성 -> 변경 및 구성 후 사용자 정의 AMI 작성 -> 사용자 정의 AMI를 사용하여 필요한 인스턴스 생성

## 인스턴스 스토어

- 인스턴스의 로컬 저장소
- 임시 데이터 저장소
- 데이터 복제 미 지원(by default)
- Snapshot 미 지원
- SSD 또는 HDD
- 레이턴시가 낮아 성능이 좋지만, 인스턴스 중지 시 다른 호스트 머신에서 사용할 수 없다. 휘발성 데이터 사용에 용이

## EBS

- 블록 스터리지
- API를 이용하여 생성, 연결, 수정
- 워크로드에 따라 스토리지 및 컴퓨팅 선택
- 프로비저닝된 IOPS SSD(io1, io2) 볼륨은 다중 연결 지원
- SSD 기반, HDD 기반 볼륨 유형 선택
- 스냅 샷 지원: 특정 시점 백업
  - S3에 백업. 증분식 백업. 추가된 용량만 백업.

## EC2 인스턴스 생명 주기

- 실행중(Running)
  - 인스턴스 동작 중 상태
  - 과금 발생
  - 정지/종료/리붓 명령으로 상태 전이 가능
- 정지됨(Stopped)
  - 중지된 상태
  - EBS 볼륨을 루트로 사용하는 인스턴스 가능
  - 과금 안 됨
  - 시작/종료 명령으로 상태 전이 가능
- 종료됨(Terminated)
  - 인스턴스가 완전히 제거된 상태
  - 시작이나 정지 불가능
  - 과금 안 됨
- Hibernated(최대 절적)
  - 처음 설정 해야함.
  - 메모리 상태도 유지.
- 실행중에만 비용이 나가지만 고정 IP, EBS 비용은 청구 될 수 있다.

## EC2 Instance Types

- 범용 M
- 버스팅용 T

### 범용 워크로드

- T4g T3 T3a T2 M6g M6i M6a M5 M5a M5n M5zn M4 A1 Mac
- ...

### 컴퓨팅 집약적인 워크로드

- 배치 프로세싱...

### 메모리 집약적인 워크로드

- 인메모리 캐시
- 고성능 데이터 베이스
- 빅 데이터 분석

### 컴퓨팅 가속화 워크로드

- P, G
- 머신 러닝/AI
- 고성능 컴퓨팅
- 그래픽스

### 스토리 집약적인 워크로드

- I, D, H
- 높은 IO
- 고밀도 스토리지

### 인스턴스 유형 세부 정보

- awa.amazon.com/ko/ec2/instance-types/

## 선택 기준

- 인스턴스 유형: 인스턴스 패밀리, 인스턴스 세대, 추가 기능, 인스턴스 사이즈
- M6g.xlarge
  - g: arm기반 gpu 타입

### 추가기능

- 프로세스 g, a
- 스토리지 및 네트워크 : d,n
- 성능 : e,s

### 인스턴스 크기

- 대략 2배의 크기와 성능을 가진다(xlarge - 2xlarge)
- 작은 인스턴스 vs 큰 인스턴스
  - 작은 인스턴스로 구성했을 때 비용적으로 효율적임
- 일단 써보고 바꾸는 것이 용이

## 최적의 인스턴스 및 크기 선택

- Cost Explorer
- AWS Compute Optimizer

## EC2 구매 옵션

- 온디맨드: 갑작스럽거나 예측할 수 없는 워크로드, 수요 정의
  - 장기 약정 없이 초 단위로 컴퓨팅 용량 지불
- 예약 인스턴스(RI): 확약 및 예측 가능한 안정적인 수요
- 세이빙 플랜: EC2 및 Fargate에 대해 저렴한 요금을 제공하는 유연한 요그 모델
- 스팟 인스턴스: 내결함성, 유연성, 상태 비 저장 워크로드
  - 갑자기 내려갈 수 있음

## 컴퓨팅 관련 추가 서비스들

- Elastic Load Balancing
  - 네트워크 트래픽 분산을 통한 애플리케이션 확장선 개선
  - 여러 가용 영역을 기반으로 고가용성을 제공
  - 트래픽에 따라 자동 조정
  - 트래픽 받을 대산...

### ELB

- ALB
  - Layer 7
  - HTTP, HTTPS, gRPC
- NLB
  - Layer 4
- CLB
- Layer 4/7

## EC2 Auto Scaling

- 변화하는 수요에 동적으로 대응하고 비용을 최적화
- 비정상 인스턴스 교체(Fleet management)
- 수요에 맞게 확장

## 인스턴스 시작시 사용자 데이터(User Data)로 명령 실행

- 일반적인 구성 작업을 자동으로 수행
  - 쉘 스크립트 방식
  - cloud-init 명령 방식

## 시작 템플릿(launch templates)으로 인스턴스 시작

- 시작을 간소화하고 단순화하기 위해 시작 요청을 템플릿화
  - 일관된 겨엄
  - 단순한 권한
  - 거버넌스 및 모범 사례
  - 생산성 향상

## Amazon CloudWatch

- AWS 리소스 및 애플리케이션의 모니터링 및 관찰 기능
- 로그, 지표 및 이벤트 형태로 모니터링 및 운영 데이터를 수집
- AWS 리소스, 애플리케이션 및 서비스에 대한 통합 뷰
- 이상 동작 감지
- 경보 설정
- 로그와 지표 시각화

# Databases

## 데이터 트랜드

- 폭발적인 데이터 증가
- Micro-service로 변화된 데이터, 분석 요구
- 빠른 변화율

## 완전 관리형 데이터베이스

## 목적에 맞게 구축된 데이터베이스

## Legacy 상업용 데이터베이스

## RDS

- 관계형 데이터베이스 서비스
- 가장 많이 선호하는 6가지 데이터베이스 엔진을 갖춘 관계형 데이터베이스
- 관리 용이성, 가용성 및 내구성, 뛰어난 확장성, 빠른 성능과 보안

### 운영 편의성

- AWS 관리 콘솔이나 AWS CLI, 간단한 API 호출 등으로 모든 관계형 DB 관리 가능
- 몇 번의 클릭만으로 하드웨어 프로비저닝, 패치, 백업, 복구, 확장 고가용성 등의 작업이 가능
- 빌트인...

### 모니터링

- 클라우드와치 지표 모니터링 가능
- 클라우드와치 로그로 디비 로그도 통합관리 가능
- Enhnaced 모니터링하면 시스템 수준 지표 모니터링 및 1초 단위 모니터링 가능

### 경보(Alarm)

- SNS와 연계로 알림을 받을 수 있다
- 이메일 HTTP Endpoint로 받을 수 있다.

### 성능 개선 도우미(Performance Insights)

- 로드를 유발하는 SQL 문과 이유를 쉽게 알 수 있음.

### 가용성 및 내구성 - Multi-AZ

- 물리적으로 분리된 가용 영역에 standby 데이터베이스를 운영하여 가용성이 높음
- 동기적 복제
- 자동 Failover(1-2분 이내)
- Primary 안정성을 위해 Stand-by 복제 본에 백업, 패치, 시스템 업그레이드 먼저 수행
- 한 번의 클릭으로 생성(운영 중 수행 또한 가능)

#### 읽기 전용 복제본

- 읽기 업무를 분담하여 소스 데이터베이스에 대한 워크로드 부하 완화
- 다른 지역의 애플리케이션에 데이터를 제공
- 장애 발생 시 빨른 복구를 위해 읽기 전용 복제 본을 마스터로 승격

#### 다중 가용 영역 배포 또는 일기 전용 복제본을 써야 할 때

- 가용성이 중요하다면 다중 가용 영역 배포가 좋다. failover
- 다중 가용 영역은 하나는 스탠바이 상태이다. 읽기에 부하가 많다면 읽기 전용 복제본이 좋다.
- 두 가지를 섞어서 쓰는 것이 좋다.

#### 자동 백업

- 매일 전체 인스턴스에 대한 볼륨 백업
- 데이터베이스 변경 로그 저장
- 기본 7일, 최대 35일
- 백업 중 데이터베이스 성능 영향 최소화
- 다중 가용 영역 배포 사용시 standby를 통한 백업

#### 데이터베이스 스냅샷

- 증분 식 백업
- Amazon S3
  - 11 - 9
- 스냅샷 암호화 기능 지원
- 여러 region에 복사하거나 다른 계정과 공유 가능

### 뛰어난 확장성

- 다양한 CPU/메모리 옵션
- 스토리지 확장이 운영 중에 가능
- General Purpose
- Provisioned IOPS
- Storage Autoscaling

### 성능과 보관

- Amazon Virtual Private Cloud를 사용한 네트워크 격리
- IAM 기반 리소스 수준 권한 제어
- KMS(모든 엔진) 또는 IDE(오라클, 마이크로소프트)를 사용하여 저장 데이터 암호화
- 전송 중인 데이터에 SSL 보호 사용

## Aurora

- 오픈 소스 호환, 사용 등급 데이터 베이스
  - MySQL, PostgreSQL 호환

### 확정, 분산 형 아키텍처

- 분성 형 스토리지 시스템
- 인스턴스 노드, 스토리지 노드가 분리되어 관리
  - 3개의 가용 영역에서 수백 개 이상의 스토리지 노드로 스트라이핑
- 6개의 복제 본 유지(각각의 가용 영역에 2개의 복제)
- 스토리지를 공유하여 복제 작업 부하도 줄어들도록 함

### 전통적인 데이터 복제 방식

- Replica 인스턴스에 동기적으로 데이터 복제
- 각 데이터베이스 이느턴스 마다 똑같은 데이터가 복제
- 같은 쓰기 작업에 대해 비효율적인 쓰기 I/O

### 오로라의 데이터 복제 방식

- 읽기 전용 복제 본에 비동기적으로 페이지 캐시를 업데이트
- 데이터 복제 작업을 스토리지 레벨에서 처리
- 공유 스토리지 구조에서 불필요한 쓰기 작업이 생략

### 오로라 서버리스

- 필요할 때만 사용하고 사용하지 않을 때는 shutdown
- 스케일 업/다운 자동화
- 초당 사용 금액으로 과금
- 자주 사용되지 않거나, 예측할 수 없거나 주기적인 워크로드에 적합

## 데이터 서비스

- 데이터베이스 마이그레이션 서비스(DMS)
  - 동족 및 이기종도 가능
  - 소스 데이터베이스의 변동 사항 지속 복제(CDC)
- Schema Conversion Tool(SCT)
  - 스키마 다른 데이터베이스 엔진 스키마로 변환
  - 관계형 OLTP 변환 지원
  - 데이터 웨어하우스 변환 지원

# Storage

## 스토리지 타입

- 블록 스토리지
  - 데이터베이스에 많이 사용
  - 블록 단위로 데이터 저장
- 파일 스토리지
  - NAS도 파일 스토리지의 일종
  - 디렉토리 구조로 파일을 저장
- 오브젝트 스토리지
  - REST 기반의 API 호출을 통해 데이터에 접근 HTTP 프로토콜
  - S3가 대표적이다.

## Amazon Elastic Block Store(EBS)

- EC2에서 사용하도록 설계된 영구 지속 블록 스토리지 서비스
- 고가용성, 안정성, 확장성, 성능, 백업
- 볼륨 타입: NoSQL 데이터베이스 / 관계형 데이터베이 / 빅데이터, 분석 / 파일, 미디어

## EFS

- EFS, FSx(윈도우 파일 서비스)
- 안정적이고 비용 효율적인 클라우드 네이티브 NFS 파일 스토리지 서비스
- EFS는 여러 AZ에걸쳐 데이터를 저장하여 높은 수준의 가용성과 내구성을 제공함.
- EFS Infrequent Access(IA)에서는 자주 사용하지 않는 것 최적화

## Amazon Simple Storage Service(S3)

- 무제한에 가까운 스토리지 용량과 오브젝트
- 많은 티어를 가지고 있어 세부적 보관이 가능
- 스토리지 클래스가 다양하다
  - 스댄다드: 가장 기본. 자주 접근
  - Glacier Deep Archive: 감사. 오래 안 쓰는 데이터 저장용
  - Intelligent-Tiering: 잘 모르겠을 때. 30일 후에 적용됨.
  - One Zone-IA: 기본 3곳에 저장되는데 1곳에만 저장하는 스토리지 서비스

### 오브젝트 복제

- 같은 리전 가능
- 다른 지전간 오브젝트 복제도 가능
- 정책 설정이 좋다.

### Multi-destination 복제

### 스토리지 렌즈

- 가시성을 제공. 어떻게 활용하는지. 비용. 크기 등을 알려줌
