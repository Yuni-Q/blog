---
title: 웹과 통신
date: 2020-04-16 13:04:67
category: develop
draft: true
---

## HTTP 요청 흐름 (웹브라우저에서의 요청)

1. 브라우저에서 먼저 URL에 적힌 값을 파싱하여, HTTP 요청 메세지를 만듭니다.
2. 만든 메세지를 웹 서버로 전송하는데, 이때 웹 브라우저 직접 전송을 하는것이 아니라 OS에 '보내주세요' 하고 의뢰를 하게 됩니다.
3. OS는 DNS서버를 조회해서 Host이름을 보내야 할 IP 주소로 변환하게 됩니다.

---

4. 프로토콜 스택(운영체제에 내장된 네트워크 제어용 소프트웨어, TCP/IP 계층)과 LAN 어댑터에서 브라우저로부터 메시지를 받습니다.
5. 브라우저로부터 받은 메시지를 패킷 속에 저장합니다. 그리고 수신 주소를 제어정보에 덧붙입니다.
6. 그 다음, 패킷은 LAN 어댑터에 넘깁니다.
7. LAN 어댑터는 패킷을 전기 신호로 변환시켜 LAN 케이블에 송출하게 됩니다.

---

8. 허브, 스위치, 라우터 에서 LAN 어댑터로부터 송신한 패킷을 수신합니다.
9. 라우터는 패킷을 ISP에 전달, 인터넷으로 들어가게 됩니다.

---

10. 액세스 회선에 의해 통신사용 라우터(POP, Point Of Presence)까지 운반됩니다.
    - 액세스 회선, ISP : 액세스 회선이라는 것은 인터넷의 입구에 있는 통신 회선입니다.
11. POP를 거쳐 인터넷의 핵심부로 들어가게 된다. 고속 라우터들 사이로 목적지까지 패킷이 흘러가게 된다.

---

12. 인터넷 핵심부를 통과한 패킷은 목적지의 LAN에 도착하게 됩니다.
13. 방화벽이 먼저 패킷을 검사한 후, 캐시서버로 보내서 웹 서버까지 갈 필요가 있는지 검사합니다.

---

14. 패킷이 물리적 웹 서버에 도착하면, 웹 서버의 프로토콜 스택이 패킷을 추출하여 메시지를 복원하고, 웹 서버 애플리케이션에 넘깁니다.
15. 애플리케이션은 요청에 대한 응답 데이터를 넣어 클라이언트로 회송합니다.
16. 온 방식 그대로 전송되게 됩니다.

## HTTP/HTTPS 차이

- HTTP + SSL = HTTPS
- HTTP는 평문 통신입니다.
- TCP/IP 특성상 도청이 가능하며, 통신 상대를 확인하지 않기 때문에 위장이 가능합니다. 가령 나는 IP가 A인 사람한테 보내고 싶은데, 악의적인 해커가 내가 IP A요 하고 말해도 검증할 방법이 없다는 것입니다.
- 또한 완전성을 증명할 수 없기 때문에 변조가 가능합니다.
- 보안 방법은 통신 자체를 암호화(SSL, TLS)하거나, 콘텐츠를 자체를(HTTP 메시지 컨텐츠를) 암호화 하는 것입니다.
- 도청이 가능한 문제, 사용자를 확인할 수 없다는 문제, 정확성을 보장할 수 없다는 문제를 모두 해결할 방안으로 나온 것이 HTTPS 입니다.

---

- HTTPS는 새로운 프로토콜이 아닌, HTTP에서 SSL 개념을 더한 프로토콜입니다.
- 기존 HTTP는 TCP와 직접 통신했지만, HTTPS는 HTTP와 TCP 사이에 SSL, TLS가 끼워져 있는 것입니다. HTTP는 SSL과 통신하고, SSL은 TCP와 통신하게 됩니다.

### SSL

- SSL의 원리를 간략하게 설명하면, 대칭키와 공개키 방식 두 암호화 방식을 사용합니다.

1. 먼저 클라이언트가 서버에게 HELLO 메세지를 보내면, 서버가 클라이언트에게 HELLO 메세지를 보내면서, 서버 암호화 된 인증서와 랜덤 데이터를 넘겨주게 됩니다.
2. HELLO 과정에서 어떤 암호화 프로토콜을 사용할 것인지 협상합니다.
3. 클라이언트는 받은 인증서를 CA리스트에서 조회 후 CA 공개키를 사용하여 인증서를 복호화합니다.
4. 복호화에 성공 했다면 이 서버는 신뢰할 수 있는 서버입니다.
5. 서버가 보낸 랜덤 데이터와 클라이언트의 랜덤 데이터를 조합해서 대칭키를 생성하니다.
6. 서버로부터 받은 공개키(인증서)를 사용하여 대칭키를 암호화 후에, 서버에게 보내게 됩니다.
7. 서버는 암호화된 대칭키를 받고, 비밀키로 복호화 함으로써, 서버와 클라이언트가 서로 대칭키를 가지게 된다.
8. 이 대칭키로 통신을 암호화합니다.

## TCP/UDP 등 로우레벨 통신 지식

### TCP

- TCP 3-way hand shake, 4-way hand shake
- TCP는 흐름제어, 오류제어를 통한 연결 지향성, 순서 중요함, 오류시 재전송. 전이중과 점대점(각 연결이 정확히 2개의 종단점을 가지고 있습니다.) 방식.

### UDP

- UDP는 비연결형 프로토콜, 상대방이 받든지 말든지 그냥 보냅니다.
- 손상된 세그먼트에 대해 재전송하지 않습니다. 만약 클라이언트 timeout이 발생하면 다시 보내면 그만입니다.

## CORS(Cross Origin Resource Sharing)란?

- 말 그대로 다른 도메인간의 자원 공유를 의미합니다.
- 본래 대부분의 브라우저는 타 도메인 간 요청을 Same-Origin-Policy에 의해 차단합니다.
- 이런 설정을 우회하기 위해 여러 방법이 있었지만, HTML5가 등장하면서 CORS가 등장했습니다.
- CORS는 헤더를 통하여 Cross-Domain간 사용가능한 자원을 헤더를 통하여 알려줍니다.

### Preflight Request

- 실제 요청을 보내도 안전한지 판단하기 위해 브라우저에서 먼저 보내보는 Request 입니다.
- Option 메서드로 전송하여 CORS를 허용하는 지 확인합니다.
- CORS를 지원하는 웹서버라면 사용가능한 리소스를 헤더에 담아 응답합니다.

## HTTP Header Description

| HTTP Header                      | Description                         |
| -------------------------------- | ----------------------------------- |
| Access-Control-Allow-Origin      | 접근 가능한 URL 설정                |
| Access-Control-Allow-Credentials | 접근 가능한 쿠키 설정 (true, false) |
| Access-Control-Allow-Headers     | 접근 가능한 헤더 설정               |
| Access-Control-Allow-Methods     | 접근 가능한 메서드 설정             |

## OSI 7 계층 및 TCP/IP 계층

- 통신이 일어나는 과정을 단계별로 파악하여, 문제 발생시 트러블슈팅이 용이합니다. 즉 분할 정복이 가능합니다.

### OSI7

- 통신 접속에서 완료까지 과정을 7단계로 정의한 국제 통신 표준 규약입니다.

### TCP/IP 4계층

- 통신에 실제 사용되는 계층입니다.(프로토콜 스택)
- 링크,네트워크,트랜스포트,어플리케이션으로 이루어집니다.
  - 링크 = 물리+데이터링크
  - 어플리케이션 = 세프어

## 멀티파트 업로드

- 멀티파트란 각 여러 파일을 바디 하나에 메타 정보와 데이터를 boundary를 기준으로 나눠 놓은 것입니다.

## 참고

- [기술면접 준비하기](https://velog.io/@hygoogi/%EA%B8%B0%EC%88%A0%EB%A9%B4%EC%A0%91-%EC%A4%80%EB%B9%84%ED%95%98%EA%B8%B0)
